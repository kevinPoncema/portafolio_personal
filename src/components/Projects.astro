---
// Archivo: src/components/Projects.astro
import portafolio from '../json/portafolio.json';
import ImageCarrusel from './ImageCarrusel.astro';
---

<section class="w-full bg-gray-100 py-12">
  <div class="container mx-auto">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Proyectos</h2>
    <div class="flex flex-wrap justify-center">
      {portafolio.proyectos.map((proyecto) => (
        <div class="w-full sm:w-1/2 lg:w-1/3 p-4" key={proyecto.titulo}>
          <div class="project-card bg-white shadow-lg rounded-lg p-6 h-full flex flex-col">
            <div class="mb-4 flex-shrink-0">
              <ImageCarrusel imagenes={proyecto.imagenes} altText={proyecto.titulo} />
            </div>
            <div class="flex flex-col flex-grow">
              <h3 class="text-xl font-bold text-gray-800 mb-2 line-clamp-2">{proyecto.titulo}</h3>
              <p class="text-gray-700 mb-4 flex-grow text-sm leading-relaxed description-text">{proyecto.descripcion}</p>
              <div class="flex flex-wrap gap-2 mb-4">
                {proyecto.tecnologias.map((tecnologia) => (
                  <span class="bg-blue-100 px-3 py-1 rounded-lg text-blue-800 font-bold text-xs" key={tecnologia}>
                    {tecnologia.toUpperCase()}
                  </span>
                ))}
              </div>
              <div class="border-t pt-4 flex justify-between items-center mt-auto">
                <a 
                  href={proyecto.github} 
                  target="_blank" 
                  class="text-gray-600 hover:text-gray-800 transform transition-transform duration-300 hover:scale-110 github-link" 
                  data-project-name={proyecto.titulo} 
                  data-link-type="GitHub">
                  <img src="/icons/github.svg" alt="GitHub" class="w-6 h-6">
                </a>
                <a 
                  href={proyecto.produccion} 
                  target="_blank" 
                  class="text-gray-600 hover:text-gray-800 transform transition-transform duration-300 hover:scale-110 production-link" 
                  data-project-name={proyecto.titulo} 
                  data-link-type="Producción">
                  <img src="/icons/share.svg" alt="Producción" class="w-6 h-6">
                </a>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.addEventListener('click', (event) => {
      // Verifica si el clic es en un enlace con data-project-name
      const target = event.target.closest('a[data-project-name]');
      if (!target) return;

      // Obtén los datos del enlace
      const projectName = target.getAttribute('data-project-name');
      const linkType = target.getAttribute('data-link-type');

      // Envía el evento a Google Analytics
      if (typeof gtag === 'function') {
        gtag('event', 'click', {
          'event_category': linkType,
          'event_label': projectName
        });
      }

      // Para depuración
      console.log(`Evento enviado: ${linkType} - ${projectName}`);
    });
  });
</script>

<style>
  section {
    padding: 3rem 0;
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
  }
  .flex-wrap {
    display: flex;
    flex-wrap: wrap;
    align-items: stretch; /* Para que todas las cards tengan la misma altura */
  }
  .p-4 {
    padding: 1rem;
    display: flex; /* Para que la card ocupe toda la altura disponible */
  }
  
  .project-card {
    min-height: 550px; /* Altura mínima para uniformidad */
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .project-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }
  
  .description-text {
    display: -webkit-box;
    -webkit-line-clamp: 6; /* Limita a 6 líneas máximo */
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    max-height: 8.5rem; /* Altura máxima para la descripción */
    line-height: 1.4;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  img {
    max-width: 100%;
    height: auto;
  }
  
  span {
    padding: 0.25rem 0.75rem;
    border-radius: 0.5rem;
    background-color: #bfdbfe;
    color: #1e3a8a;
    font-weight: bold;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  
  .border-t {
    border-top: 1px solid #e5e7eb;
  }
  
  a:hover img {
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
  
  /* Responsive design mejorado */
  @media (max-width: 640px) {
    .project-card {
      min-height: 500px;
    }
    .description-text {
      -webkit-line-clamp: 5;
      max-height: 7rem;
    }
  }
  
  @media (min-width: 1024px) {
    .w-full.sm\:w-1\/2.lg\:w-1\/3 {
      width: 33.3333%;
    }
  }
  
  @media (min-width: 1200px) {
    .project-card {
      min-height: 580px;
    }
  }
</style>
